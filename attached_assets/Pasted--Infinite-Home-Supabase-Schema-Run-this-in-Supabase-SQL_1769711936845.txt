-- Infinite Home - Supabase Schema
-- Run this in Supabase SQL Editor

-- Admins Table
CREATE TABLE IF NOT EXISTS admins (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Categories Table
CREATE TABLE IF NOT EXISTS categories (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    name TEXT NOT NULL UNIQUE,
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Products Table
CREATE TABLE IF NOT EXISTS products (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    name TEXT NOT NULL,
    description TEXT,
    price REAL NOT NULL,
    sale_price REAL,
    category TEXT NOT NULL,
    image TEXT NOT NULL,
    images JSONB DEFAULT '[]'::JSONB,
    colors JSONB DEFAULT '[]'::JSONB,
    color_images JSONB DEFAULT '{}'::JSONB,
    variants JSONB DEFAULT '[]'::JSONB,
    stock INTEGER DEFAULT 0,
    variant_stock JSONB DEFAULT '{}'::JSONB,
    express_charge REAL DEFAULT 0,
    rating REAL DEFAULT 5.0,
    reviews INTEGER DEFAULT 0,
    is_new BOOLEAN DEFAULT FALSE,
    is_best_seller BOOLEAN DEFAULT FALSE,
    is_on_sale BOOLEAN DEFAULT FALSE,
    size_guide JSONB DEFAULT '[]'::JSONB,
    certifications JSONB DEFAULT '[]'::JSONB,
    is_pre_order BOOLEAN DEFAULT FALSE,
    pre_order_price REAL,
    pre_order_initial_payment REAL,
    pre_order_eta TEXT,
    product_details TEXT,
    materials_and_care TEXT,
    show_on_storefront BOOLEAN DEFAULT TRUE,
    low_stock_threshold INTEGER DEFAULT 5,
    sku TEXT,
    barcode TEXT,
    cost_price REAL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Coupons Table
CREATE TABLE IF NOT EXISTS coupons (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    code TEXT NOT NULL UNIQUE,
    discount REAL NOT NULL,
    type TEXT NOT NULL,
    status TEXT DEFAULT 'active',
    scope TEXT DEFAULT 'store',
    allowed_categories JSONB DEFAULT '[]'::JSONB,
    allowed_products JSONB DEFAULT '[]'::JSONB,
    allow_pre_order BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Orders Table
CREATE TABLE IF NOT EXISTS orders (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    order_number TEXT NOT NULL UNIQUE,
    customer_name TEXT NOT NULL,
    customer_email TEXT NOT NULL,
    customer_phone TEXT NOT NULL,
    shipping_address TEXT NOT NULL,
    items JSONB NOT NULL,
    subtotal REAL NOT NULL,
    discount REAL DEFAULT 0,
    shipping REAL NOT NULL,
    total REAL NOT NULL,
    payment_method TEXT NOT NULL,
    payment_slip TEXT,
    status TEXT DEFAULT 'pending',
    coupon_code TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- POS Transactions Table
CREATE TABLE IF NOT EXISTS pos_transactions (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    transaction_number TEXT NOT NULL UNIQUE,
    items JSONB NOT NULL,
    subtotal REAL NOT NULL,
    discount REAL DEFAULT 0,
    gst_percentage REAL DEFAULT 0,
    gst_amount REAL DEFAULT 0,
    tax REAL DEFAULT 0,
    total REAL NOT NULL,
    payment_method TEXT NOT NULL,
    amount_received REAL,
    change REAL DEFAULT 0,
    customer_id TEXT,
    customer_name TEXT,
    customer_phone TEXT,
    cashier_id TEXT NOT NULL,
    cashier_name TEXT NOT NULL,
    notes TEXT,
    status TEXT DEFAULT 'completed',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Customers Table
CREATE TABLE IF NOT EXISTS customers (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    phone TEXT,
    address TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Customer Addresses Table
CREATE TABLE IF NOT EXISTS customer_addresses (
    id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::TEXT,
    customer_id TEXT NOT NULL,
    label TEXT NOT NULL,
    full_name TEXT DEFAULT '',
    street_address TEXT DEFAULT '',
    address_line_2 TEXT,
    city_island TEXT DEFAULT '',
    zip_code TEXT,
    mobile_no TEXT DEFAULT '',
    full_address TEXT NOT NULL,
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);